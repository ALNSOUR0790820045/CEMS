# وحدة قاعدة الأسعار المركزية (Central Price Database Module)

## نظرة عامة
وحدة متكاملة لإدارة قاعدة أسعار مركزية للمواد والعمالة والمعدات، مع تتبع تاريخي وتحديث دوري في نظام CEMS ERP.

## الميزات الرئيسية

### 1. قوائم الأسعار متعددة المصادر
- **داخلي**: أسعار الشركة الخاصة
- **وزارة الأشغال**: الأسعار الرسمية من الوزارة
- **النقابة**: أسعار نقابة المهندسين
- **السوق**: أسعار السوق المحلي
- **مورد**: أسعار من موردين محددين

### 2. أنواع الأسعار المدعومة
- مواد البناء (Materials)
- العمالة والمهن (Labor)
- المعدات والآليات (Equipment)
- أعمال المقاولين (Subcontract)
- أسعار مركبة (Composite)

### 3. تتبع التغييرات التاريخية
- تسجيل كل تغيير في الأسعار
- نسبة التغيير والفرق
- أسباب التغيير (تغير السوق، تضخم، سعر الصرف، موسمي، إلخ)
- تاريخ السريان لكل تغيير

### 4. طلبات عروض الأسعار (RFQ)
- إنشاء طلبات عروض أسعار للموردين
- إدارة البنود المطلوبة
- استلام وتسجيل عروض الأسعار
- مقارنة العروض واختيار الأفضل

### 5. البحث والمقارنة
- بحث متقدم عبر كل قوائم الأسعار
- مقارنة الأسعار من مصادر مختلفة
- عرض أقل وأعلى سعر
- حساب الفروقات والنسب

## الهيكل التقني

### قاعدة البيانات

#### الجداول الرئيسية
1. **price_lists** - قوائم الأسعار
2. **price_list_items** - بنود الأسعار
3. **price_history** - تاريخ التغييرات
4. **price_requests** - طلبات عروض الأسعار
5. **price_request_items** - بنود طلبات العروض
6. **price_quotations** - عروض الأسعار المستلمة
7. **price_quotation_items** - بنود عروض الأسعار
8. **price_comparisons** - مقارنات الأسعار

#### الجداول المساعدة
- **regions** - المناطق الجغرافية
- **materials** - المواد
- **labor_categories** - فئات العمالة
- **equipment_categories** - فئات المعدات
- **vendors** - الموردين
- **projects** - المشاريع

### النماذج (Models)
- `PriceList` - إدارة قوائم الأسعار
- `PriceListItem` - بنود الأسعار مع العلاقات
- `PriceHistory` - تتبع التغييرات
- `PriceRequest` - طلبات العروض
- `PriceQuotation` - عروض الأسعار
- `PriceComparison` - المقارنات

### المتحكمات (Controllers)
- `PriceListController` - CRUD لقوائم الأسعار
- `PriceListItemController` - إدارة البنود والتاريخ
- `PriceSearchController` - البحث والاستعلامات
- `PriceRequestController` - إدارة الطلبات
- `PriceQuotationController` - إدارة العروض
- `PriceComparisonController` - المقارنات

## المسارات (Routes)

### قوائم الأسعار
```
GET    /price-lists                 - عرض كل القوائم
POST   /price-lists                 - إنشاء قائمة جديدة
GET    /price-lists/{id}            - عرض قائمة محددة
PUT    /price-lists/{id}            - تحديث قائمة
GET    /price-lists/{id}/items      - عرض بنود القائمة
```

### البنود
```
GET    /price-lists/{id}/items/create  - نموذج إضافة بند
POST   /price-lists/{id}/items         - حفظ بند جديد
PUT    /price-list-items/{id}          - تحديث بند
GET    /price-list-items/{id}/history  - تاريخ البند
```

### البحث
```
GET    /prices/search      - البحث العام
GET    /prices/materials   - أسعار المواد
GET    /prices/labor       - أسعار العمالة
GET    /prices/equipment   - أسعار المعدات
GET    /prices/compare     - مقارنة الأسعار
```

### طلبات العروض
```
GET    /price-requests                      - عرض كل الطلبات
POST   /price-requests                      - إنشاء طلب جديد
GET    /price-requests/{id}                 - عرض طلب
POST   /price-requests/{id}/send            - إرسال الطلب
GET    /price-requests/{id}/quotations      - عروض الطلب
POST   /price-requests/{id}/quotations      - إضافة عرض
POST   /price-requests/{id}/compare         - مقارنة العروض
```

## استخدام الوحدة

### إنشاء قائمة أسعار جديدة
1. انتقل إلى "قوائم الأسعار"
2. اضغط "إضافة قائمة جديدة"
3. املأ البيانات (الكود، الاسم، النوع، المصدر، التواريخ)
4. احفظ القائمة

### إضافة بنود للقائمة
1. افتح قائمة الأسعار
2. اضغط "إضافة بند"
3. أدخل معلومات البند (الكود، الاسم، الوحدة، السعر)
4. أضف المعلومات الإضافية حسب النوع (مادة، عمالة، معدة)
5. احفظ البند

### البحث عن أسعار
1. انتقل إلى "البحث عن الأسعار"
2. أدخل كلمة البحث
3. حدد النوع والمصدر (اختياري)
4. اضغط "بحث"

### مقارنة الأسعار
1. انتقل إلى "مقارنة الأسعار"
2. ابحث عن البند المطلوب
3. سيعرض النظام جميع الأسعار من مصادر مختلفة
4. يظهر أقل وأعلى سعر والفرق بينهما

## التثبيت

1. تشغيل الهجرات:
```bash
php artisan migrate
```

2. (اختياري) ملء بيانات تجريبية:
```bash
php artisan db:seed --class=PriceSeeder
```

---

تم تطويره بواسطة فريق CEMS ERP
